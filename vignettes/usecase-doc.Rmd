---
title: "Exploring Clinical Trial Data with clintrialx"
author: "Indraneel Chakraborty"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: cerulean
    highlight: tango
    toc: true
    toc_float: true
---

## Introduction

Welcome to the `clintrialx` vignette! This package is designed to help you fetch and analyze clinical trial data effortlessly. In this guide, we'll explore how to use `clintrialx` along with some popular R packages to examine and visualize clinical trial data for cancer studies in India. 🚀

## Setup

First, let’s load the required libraries. We’ll use `suppressPackageStartupMessages` to keep things tidy:

```{r}
# Load necessary libraries
invisible(suppressPackageStartupMessages({
  library(clintrialx)  # For fetching clinical trial data
  library(ggplot2)     # For data visualization
  library(plotly)      # For interactive plots
  library(dplyr)       # For data manipulation
  library(lubridate)  # For date handling
}))
```

## Fetching Data

Let's fetch the clinical trial data for cancer studies in India. Use the `ctg_bulk_fetch` function to get started:

```{r}
# Fetch data on cancer studies in India
df <- ctg_bulk_fetch(condition = "cancer", location = "India")
```

## Visualizing Study Status Distribution 

To understand the distribution of study statuses, we'll create a bar plot. Here’s how:

```{r}
# Create a table of study statuses
status_counts <- table(df$`Study Status`)

# Convert the table to a data frame
status_df <- data.frame(status = names(status_counts), count = as.numeric(status_counts))

# Generate the bar plot
ggplotly(ggplot(status_df, aes(x = reorder(status, -count), y = count)) +
  geom_bar(stat = "identity", fill = "orange") +
  theme_minimal() +
  labs(title = "Distribution of Study Statuses",
       x = "Study Status",
       y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_text(aes(label = count), vjust = -0.5))
```

This plot provides a snapshot of the number of studies in each status category. 📉

## Analyzing Enrollment by Study Phase 

To compare enrollment numbers across different study phases, we’ll use a box plot. Interactive plots can be particularly useful here:

```{r}
# Create an interactive box plot of enrollment by study phase
ggplotly(ggplot(df, aes(x = Phases, y = Enrollment)) +
  geom_boxplot(fill = "lightblue", outlier.colour = "red", outlier.shape = 1) +
  geom_jitter(color = "darkblue", size = 0.5, alpha = 0.5, width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(title = "Enrollment by Study Phase",
       x = "Study Phase",
       y = "Enrollment") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
        plot.title = element_text(hjust = 0.5)))
```

This interactive box plot allows us to explore enrollment numbers across different study phases and spot any interesting trends. 🔍

## Visualizing Study Duration Timeline 

To see the timeline of studies, we’ll create a scatter plot:

```{r}
# Convert date strings to Date objects
df$start_date <- as.Date(df$`Start Date`, format = "%Y-%m-%d")
df$completion_date <- as.Date(df$`Completion Date`, format = "%Y-%m-%d")

# Create an interactive scatter plot
ggplotly(ggplot(df, aes(x = start_date, y = completion_date, color = `Study Status`)) +
  geom_point(alpha = 0.6) +
  theme_minimal() +
  labs(title = "Study Duration Timeline",
       x = "Start Date",
       y = "Completion Date") +
  scale_color_brewer(palette = "Set1"))
```

This scatter plot helps us visualize the duration and status of studies, offering insights into their timelines. ⏳

## Analyzing Funding Sources and Study Types

Finally, let’s examine how different funding sources relate to study types. We’ll use a stacked bar plot for this:

```{r}
# Summarize and plot funding sources by study type
df_summary <- df %>%
  count(`Funder Type`, `Study Type`) %>%
  group_by(`Funder Type`) %>%
  mutate(prop = n / sum(n))

ggplotly(ggplot(df_summary, aes(x = `Funder Type`, y = prop, fill = `Study Type`)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Funding Sources and Study Types",
       x = "Funder Type",
       y = "Proportion") +
  scale_fill_brewer(palette = "Set2") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)))
```

This plot helps to uncover patterns in how different funders support various study types. 💡

## Conclusion 

With the `clintrialx` package and visualization tools like `ggplot2` and `plotly`, you can gain valuable insights into clinical trial data. This vignette demonstrated several techniques for visualizing and interpreting cancer clinical trials in India. These methods are adaptable to any clinical trial data you fetch with `clintrialx`. Happy analyzing! 😊
